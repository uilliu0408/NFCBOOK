<!DOCTYPE html>
<html lang="ko">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>NFC ë…ì„œê¸°ë¡ì¥</title>

  <!-- Firebase SDK -->
  <script type="module">
    // Import the functions you need from the SDKs you need
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-app.js";
    import { getAnalytics } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-analytics.js";
    import { getFirestore, doc, getDoc, setDoc, updateDoc } from "https://www.gstatic.com/firebasejs/11.9.1/firebase-firestore.js";

    // Your web app's Firebase configuration
    const firebaseConfig = {
      apiKey: "AIzaSyCwf8YefXWjheKg5SYjWUqA0khJu37pMGk",
      authDomain: "chat-38c87.firebaseapp.com",
      projectId: "chat-38c87",
      storageBucket: "chat-38c87.firebasestorage.app",
      messagingSenderId: "173428820608",
      appId: "1:173428820608:web:e89fb8d19cc4e35c253465",
      measurementId: "G-5340BFY1RL"
    };

    // Initialize Firebase
    const app = initializeApp(firebaseConfig);
    const analytics = getAnalytics(app);

    const db = getFirestore(app);
    window.db = db;
    window.firestoreDoc = doc;
    window.firestoreGet = getDoc;
    window.firestoreSet = setDoc;
    window.firestoreUpdate = updateDoc;
  </script>

  <style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Serif+KR:wght@300;400;600&display=swap');

  body {
    font-family: 'Noto Serif KR', serif;
    margin: 0;
    padding: 0;
    color: #eee;
    background: url('https://images.unsplash.com/photo-1543589077-47d81606c1bf?auto=format&fit=crop&w=1600&q=80')
                no-repeat center center fixed;
    background-size: cover;
    position: relative;
    overflow-x: hidden;
  }

  /* ğŸ“Œ ëª¨ë°”ì¼ì—ì„œ ë°°ê²½ ë„ˆë¬´ í™•ëŒ€ â†’ contain ì ìš© */
  @media (max-width: 600px) {
    body {
      background-size: contain;
      background-color: #000;
    }
  }

  /* ë¶€ë“œëŸ¬ìš´ ì•ˆê°œ íš¨ê³¼ */
  body::before {
    content: '';
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    backdrop-filter: blur(2px);
    background: rgba(0,0,0,0.25);
    pointer-events: none;
    z-index: 0;
  }

  /* ëˆˆ íš¨ê³¼ */
  .forest-dust {
    position: fixed;
    top: 0; left: 0;
    width: 100%;
    height: 100%;
    pointer-events: none;
    z-index: 3;
    background-image: 
      radial-gradient(rgba(255,255,255,0.8) 2px, transparent 2px),
      radial-gradient(rgba(255,255,255,0.5) 1px, transparent 1px);
    background-size: 6px 6px, 4px 4px;
    animation: floatDust 18s linear infinite;
    opacity: 0.6;
  }

  @keyframes floatDust {
    0% { transform: translateY(0px); }
    100% { transform: translateY(800px); }
  }

  /* ğŸ“Œ ì œëª© í¬ê¸° ì¤„ì´ê³ , ë‚´ìš© ë³€ê²½ */
  header {
    background: rgba(20, 20, 20, 0.55);
    backdrop-filter: blur(6px);
    text-align: center;
    padding: 0.8rem 1rem;
    color: #f0f0f0;
    font-size: 1.2rem; /* ëª¨ë°”ì¼ì—ì„œ 1ì¤„ ìœ ì§€ìš© */
    letter-spacing: 1px;
    border-bottom: 1px solid rgba(255,255,255,0.15);
    position: relative;
    z-index: 5;
  }

  @media (max-width: 600px) {
    header {
      font-size: 1.05rem;
      padding: 0.6rem;
    }
  }

  main {
    padding: 1.5rem;
    max-width: 820px;
    margin: auto;
    position: relative;
    z-index: 10;
  }

  .box {
    background: rgba(40, 40, 40, 0.55);
    backdrop-filter: blur(8px);
    border-radius: 15px;
    padding: 1.5rem;
    margin-bottom: 1.4rem;
    border: 1px solid rgba(255,255,255,0.15);
    box-shadow: 0 6px 25px rgba(0,0,0,0.35);
    animation: fadeIn 0.4s ease;
  }

  @keyframes fadeIn {
    from { opacity: 0; transform: translateY(8px); }
    to { opacity: 1; transform: translateY(0px); }
  }

  /* ğŸ“Œ ì…ë ¥ì¹¸ ì‚ì ¸ë‚˜ì˜´ í•´ê²°: box-sizing ì ìš© */
  input, textarea, select {
    width: 100%;
    max-width: 100%;
    margin: 0.6rem auto 1rem;
    padding: 0.7rem;
    border-radius: 10px;
    border: none;
    background: rgba(255,255,255,0.85);
    color: #2b2b2b;
    font-size: 1rem;
    box-shadow: 0 2px 6px rgba(0,0,0,0.15);
    box-sizing: border-box; /* í•µì‹¬ */
  }

  input::placeholder, textarea::placeholder {
    color: #7a7a7a;
  }

  textarea {
    resize: vertical;
    min-height: 90px;
  }

  button {
    width: 100%;
    padding: 0.8rem;
    margin-top: 0.7rem;
    border: none;
    border-radius: 12px;
    background: #d8b58a;
    color: #2e2b26;
    font-weight: 600;
    font-size: 1rem;
    cursor: pointer;
    box-shadow: 0 3px 10px rgba(0,0,0,0.25);
    transition: 0.2s ease;
  }

  button:hover {
    background: #c9a476;
    transform: translateY(-2px);
  }

  .entry img, .trash-entry img {
    border-radius: 14px;
    max-width: 100%;
    margin-top: 0.5rem;
    box-shadow: 0 4px 18px rgba(0,0,0,0.4);
    cursor: pointer;
  }

  #entries, #trashBin, #bookForm {
    display: none;
  }
  </style>
</head>
<body>
  <!-- ëˆˆ íš¨ê³¼ ë ˆì´ì–´ (ì„ íƒ ì‚¬í•­) -->


  <header>
    <h1>ğŸ„ë…ì„œê¸°ë¡ì¥ğŸ„</h1>
  </header>

  <main>
    <!-- ğŸ” ë¹„ë°€ë²ˆí˜¸ ì„¹ì…˜ -->
    <div class="box" id="passwordSection">
      <label id="passwordLabel">ë¹„ë°€ë²ˆí˜¸ë¥¼ ë¶ˆëŸ¬ì˜¤ëŠ” ì¤‘ì…ë‹ˆë‹¤...</label>
      <input type="password" id="password" maxlength="4" placeholder="4ìë¦¬ ìˆ«ì" />

      <!-- ìƒˆ ë°©ì¼ ë•Œë§Œ ë³´ì´ëŠ” ë¹„ë°€ë²ˆí˜¸ í™•ì¸ -->
      <div id="passwordConfirmWrapper" style="display:none;">
        <label>ë¹„ë°€ë²ˆí˜¸ í™•ì¸</label>
        <input type="password" id="passwordConfirm" maxlength="4" placeholder="ë‹¤ì‹œ í•œ ë²ˆ ì…ë ¥" />
      </div>

      <button onclick="checkPassword()">ì ‘ì†</button>
      <p id="passMsg" style="color:#ff9e9e;"></p>
    </div>

    <!-- ğŸ“š ê¸°ë¡ ì…ë ¥ í¼ -->
    <div id="bookForm" class="box">
      <label>ì±… ì œëª©</label><input id="title" type="text" />
      <label>ì‘ê°€</label><input id="author" type="text" />
      <label>ì½ì€ ë‚ ì§œ</label><input id="date" type="date" />
      <label>ì½ì€ í˜ì´ì§€</label><input id="pages" type="text" />
      <label>ì±… ë‚´ìš© ìš”ì•½</label><textarea id="summary"></textarea>
      <label>ì¸ìƒ ê¹Šì€ ë¬¸ì¥</label><textarea id="quote"></textarea>
      <label>ì±… ê´€ë ¨ ì‚¬ì§„</label>
      <input type="file" id="imageInput" accept="image/*" onchange="handleImageUpload(event)" />
      <label>ë³„ì </label>
      <select id="rating">
        <option value="â­ï¸">â­ï¸</option><option value="â­ï¸â­ï¸">â­ï¸â­ï¸</option>
        <option value="â­ï¸â­ï¸â­ï¸">â­ï¸â­ï¸â­ï¸</option><option value="â­ï¸â­ï¸â­ï¸â­ï¸">â­ï¸â­ï¸â­ï¸â­ï¸</option>
        <option value="â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸">â­ï¸â­ï¸â­ï¸â­ï¸â­ï¸</option>
      </select>
      <button onclick="saveEntry()">ê¸°ë¡ ì €ì¥</button>
      <button onclick="toggleTrash()">íœ´ì§€í†µ ë³´ê¸°</button>
      <button onclick="toggleChangePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
    </div>

    <!-- ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì„¹ì…˜ -->
    <div id="changePasswordSection" class="box" style="display:none;">
      <label>ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="oldPassword" maxlength="4"/>
      <label>ìƒˆ ë¹„ë°€ë²ˆí˜¸</label><input type="password" id="newPassword" maxlength="4"/>
      <button onclick="changePassword()">ë¹„ë°€ë²ˆí˜¸ ë³€ê²½</button>
      <p id="changeMessage" style="color:#ffdfdf;"></p>
    </div>

    <!-- ğŸ—‘ íœ´ì§€í†µ -->
    <div id="trashBin" class="box">
      <h3>ğŸ—‘ï¸ íœ´ì§€í†µ</h3>
      <div id="trashEntries"></div>
      <button onclick="clearTrash()">íœ´ì§€í†µ ë¹„ìš°ê¸°</button>
    </div>

    <!-- ğŸ“„ ê¸°ë¡ ëª©ë¡ -->
    <div id="entries"></div>
  </main>

  <!-- ì´ë¯¸ì§€ ëª¨ë‹¬ -->
  <div id="imageModal" onclick="closeModal()" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%;
       background-color:rgba(0,0,0,0.9); z-index:9999; justify-content:center; align-items:center;">
    <img id="modalImage" style="position:absolute; top:50%; left:50%; transform:translate(-50%, -50%);
         max-width:95%; max-height:95%; box-shadow:0 0 30px rgba(255,255,255,0.5); border-radius:10px;" />
  </div>

  <script>
    const urlParams = new URLSearchParams(window.location.search);
    const roomId = urlParams.get("id") || "default";

    // ì˜ˆì „ localStorageìš© í‚¤ (ì§€ê¸ˆì€ ì‚¬ìš© X, ê·¸ëƒ¥ ë‘¬ë„ ë¬¸ì œ ì—†ìŒ)
    const passKey  = `password_${roomId}`;
    const dataKey  = `readingEntriesNFC_${roomId}`;
    const trashKey = `trashEntries_${roomId}`;

    // ğŸ” Firestore ê¸°ë°˜ ë¹„ë°€ë²ˆí˜¸ ê´€ë¦¬ìš© ìƒíƒœ
    let isNewRoom = false;          // trueë©´ ìƒˆ ë°© â†’ ë¹„ë²ˆ ì„¤ì • ëª¨ë“œ
    let roomPasswordCache = null;   // Firestoreì—ì„œ ì½ì–´ì˜¨ ë¹„ë²ˆ ìºì‹œ

    // ğŸ” í˜ì´ì§€ ë¡œë“œì‹œ, ì´ ë°©ì˜ ë¹„ë°€ë²ˆí˜¸ ìœ ë¬´ í™•ì¸
    const initPasswordUI = async () => {
      const labelEl = document.getElementById("passwordLabel");
      const confirmWrap = document.getElementById("passwordConfirmWrapper");
      const passMsg = document.getElementById("passMsg");

      try {
        const roomRef = firestoreDoc(db, "rooms", roomId);
        const docSnap = await firestoreGet(roomRef);

        if (docSnap.exists()) {
          const data = docSnap.data();
          if (data.password) {
            // âœ… ì´ë¯¸ ë¹„ë°€ë²ˆí˜¸ê°€ ìˆëŠ” ë°©
            isNewRoom = false;
            roomPasswordCache = data.password;
            if (labelEl) labelEl.textContent = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.";
            if (confirmWrap) confirmWrap.style.display = "none";
          } else {
            // ğŸ”‘ ë°©ì€ ìˆì§€ë§Œ ë¹„ë²ˆì´ ì—†ëŠ” ê²½ìš° â†’ ìƒˆ ë°© ì·¨ê¸‰
            isNewRoom = true;
            if (labelEl) labelEl.textContent = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.";
            if (confirmWrap) confirmWrap.style.display = "block";
          }
        } else {
          // ğŸ†• ì™„ì „ ìƒˆë¡œìš´ ë°©
          isNewRoom = true;
          if (labelEl) labelEl.textContent = "ë¹„ë°€ë²ˆí˜¸ë¥¼ ì„¤ì •í•´ì£¼ì„¸ìš”.";
          if (confirmWrap) confirmWrap.style.display = "block";
        }
      } catch (e) {
        console.error(e);
        if (labelEl) labelEl.textContent = "ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤. ìƒˆë¡œê³ ì¹¨ í•´ì£¼ì„¸ìš”.";
        if (passMsg) passMsg.textContent = "ë„¤íŠ¸ì›Œí¬ ë˜ëŠ” Firestore ì˜¤ë¥˜ì…ë‹ˆë‹¤.";
      }
    };

    // ğŸ” ë¹„ë°€ë²ˆí˜¸ ì²´í¬ / ì„¤ì •
    const checkPassword = async () => {
      const inputEl   = document.getElementById("password");
      const confirmEl = document.getElementById("passwordConfirm");
      const passMsg   = document.getElementById("passMsg");
      const input = (inputEl?.value || "").trim();

      passMsg.textContent = "";

      // 4ìë¦¬ ìˆ«ì ê²€ì‚¬
      if (!/^\d{4}$/.test(input)) {
        passMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ëŠ” ìˆ«ì 4ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.";
        return;
      }

      const roomRef = firestoreDoc(db, "rooms", roomId);

      if (isNewRoom) {
        // ğŸ”‘ ìƒˆ ë°© â†’ ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ëª¨ë“œ
        const confirmVal = (confirmEl?.value || "").trim();
        if (input !== confirmVal) {
          passMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ì™€ í™•ì¸ì´ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
          return;
        }

        try {
          await firestoreSet(roomRef, { password: input }, { merge: true });
          roomPasswordCache = input;
          isNewRoom = false;
          showMain();
        } catch (e) {
          console.error(e);
          passMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ ì„¤ì • ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        }
      } else {
        // ğŸ”“ ê¸°ì¡´ ë°© â†’ ë¹„ë°€ë²ˆí˜¸ ê²€ì¦
        try {
          let stored = roomPasswordCache;

          if (!stored) {
            const snap = await firestoreGet(roomRef);
            if (snap.exists()) {
              const data = snap.data();
              stored = data.password || null;
              roomPasswordCache = stored;
            }
          }

          if (!stored) {
            passMsg.textContent = "ì´ ë°©ì—ëŠ” ì•„ì§ ë¹„ë°€ë²ˆí˜¸ê°€ ì„¤ì •ë˜ì§€ ì•Šì•˜ìŠµë‹ˆë‹¤.";
            return;
          }

          if (input === stored) {
            showMain();
          } else {
            passMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ì¼ì¹˜í•˜ì§€ ì•ŠìŠµë‹ˆë‹¤.";
          }
        } catch (e) {
          console.error(e);
          passMsg.textContent = "ë¹„ë°€ë²ˆí˜¸ í™•ì¸ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
        }
      }
    };

    const showMain = () => {
      document.getElementById("passwordSection").style.display = "none";
      document.getElementById("bookForm").style.display = "block";
      displayEntries();
      displayTrash();
      document.getElementById("entries").style.display = "block";
    };

    // ğŸ“Œ Firestoreì— ê¸°ë¡ ì €ì¥
    const saveEntry = async () => {
      const entry = {
        title:   document.getElementById("title").value,
        author:  document.getElementById("author").value,
        date:    document.getElementById("date").value,
        pages:   document.getElementById("pages").value,
        summary: document.getElementById("summary").value,
        quote:   document.getElementById("quote").value,
        rating:  document.getElementById("rating").value,
        image:   uploadedImageBase64
      };

      const roomRef = firestoreDoc(db, "rooms", roomId);
      const docSnap = await firestoreGet(roomRef);
      let entries = [];

      if (docSnap.exists()) {
        const data = docSnap.data();
        entries = data.entries || [];
      }

      entries.push(entry);

      await firestoreSet(roomRef, { entries: entries }, { merge: true });
      alert("ê¸°ë¡ì´ ì €ì¥ë˜ì—ˆìŠµë‹ˆë‹¤!");
      displayEntries();
    };

    // ğŸ“Œ ê¸°ë¡ ë³´ì—¬ì£¼ê¸°
    const displayEntries = async () => {
      const roomRef = firestoreDoc(db, "rooms", roomId);
      const docSnap = await firestoreGet(roomRef);
      if (!docSnap.exists()) return;

      const data = docSnap.data();
      const entries = data.entries || [];

      const div = document.getElementById("entries");
      div.innerHTML = "";

      entries.slice().reverse().forEach((entry, i, arr) => {
        const trueIndex = arr.length - 1 - i;
        div.innerHTML += `
          <div class="entry box">
            <h3>${entry.title} - ${entry.author}</h3>
            <p><strong>ë‚ ì§œ:</strong> ${entry.date}</p>
            <p><strong>í˜ì´ì§€:</strong> ${entry.pages}</p>
            <p><strong>ìš”ì•½:</strong> ${entry.summary}</p>
            <p><strong>ì¸ìƒ ê¹Šì€ ë¬¸ì¥:</strong> "${entry.quote}"</p>
            <p><strong>ë³„ì :</strong> ${entry.rating}</p>
            ${entry.image ? `<img src="${entry.image}" style='max-width:100%;' onclick='openModal("${entry.image}")'/>` : ""}
            <button onclick="confirmDelete(${trueIndex})">ì‚­ì œ</button>
          </div>`;
      });
    };

    // ğŸ“Œ íœ´ì§€í†µ ëª©ë¡
    const displayTrash = async () => {
      const roomRef = firestoreDoc(db, "rooms", roomId);
      const docSnap = await firestoreGet(roomRef);
      if (!docSnap.exists()) return;

      const data = docSnap.data();
      const trash = data.trash || [];

      const div = document.getElementById("trashEntries");
      div.innerHTML = "";
      trash.slice().reverse().forEach((entry, i, arr) => {
        const trueIndex = arr.length - 1 - i;
        div.innerHTML += `
          <div class="trash-entry box">
            <h4>${entry.title} - ${entry.author}</h4>
            <button onclick="restoreEntry(${trueIndex})">ë³µêµ¬</button>
          </div>`;
      });
    };

    // ğŸ“Œ ì‚­ì œ â†’ íœ´ì§€í†µ ì´ë™
    const confirmDelete = async (index) => {
      if (!confirm("íœ´ì§€í†µìœ¼ë¡œ ë³´ë‚¼ê¹Œìš”?")) return;

      const roomRef = firestoreDoc(db, "rooms", roomId);
      const docSnap = await firestoreGet(roomRef);
      if (docSnap.exists()) {
        let data = docSnap.data();
        let entries = data.entries || [];
        let trash = data.trash || [];

        const deleted = entries.splice(index, 1)[0];
        trash.push(deleted);

        await firestoreUpdate(roomRef, {
          entries: entries,
          trash: trash
        });

        displayEntries();
        displayTrash();
      }
    };

    // ğŸ“Œ íœ´ì§€í†µ â†’ ë³µêµ¬
    const restoreEntry = async (index) => {
      const roomRef = firestoreDoc(db, "rooms", roomId);
      const docSnap = await firestoreGet(roomRef);
      if (!docSnap.exists()) return;

      let data = docSnap.data();
      let entries = data.entries || [];
      let trash = data.trash || [];

      const restored = trash.splice(index, 1)[0];
      entries.push(restored);

      await firestoreUpdate(roomRef, {
        entries: entries,
        trash: trash
      });

      displayEntries();
      displayTrash();
    };

    const toggleTrash = () => {
      const bin = document.getElementById("trashBin");
      bin.style.display = bin.style.display === "block" ? "none" : "block";
      const entriesDiv = document.getElementById("entries");
      if (bin.style.display === "block") {
        entriesDiv.parentNode.insertBefore(bin, entriesDiv);
      }
    };

    const toggleChangePassword = () => {
      const section = document.getElementById("changePasswordSection");
      section.style.display = section.style.display === "block" ? "none" : "block";
    };

    // ğŸ” ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ (Firestore ì‚¬ìš©)
    const changePassword = async () => {
      const oldPass = document.getElementById("oldPassword").value.trim();
      const newPass = document.getElementById("newPassword").value.trim();
      const msg = document.getElementById("changeMessage");
      msg.textContent = "";

      if (!/^\d{4}$/.test(newPass)) {
        msg.textContent = "ìƒˆ ë¹„ë°€ë²ˆí˜¸ëŠ” ìˆ«ì 4ìë¦¬ì—¬ì•¼ í•©ë‹ˆë‹¤.";
        return;
      }

      try {
        const roomRef = firestoreDoc(db, "rooms", roomId);
        const snap = await firestoreGet(roomRef);

        if (!snap.exists() || !snap.data().password) {
          msg.textContent = "ì„¤ì •ëœ ë¹„ë°€ë²ˆí˜¸ê°€ ì—†ìŠµë‹ˆë‹¤.";
          return;
        }

        const current = snap.data().password;
        if (oldPass !== current) {
          msg.textContent = "ê¸°ì¡´ ë¹„ë°€ë²ˆí˜¸ê°€ ì˜¬ë°”ë¥´ì§€ ì•ŠìŠµë‹ˆë‹¤.";
          return;
        }

        await firestoreUpdate(roomRef, { password: newPass });
        roomPasswordCache = newPass;
        msg.textContent = "ë¹„ë°€ë²ˆí˜¸ê°€ ë³€ê²½ë˜ì—ˆìŠµë‹ˆë‹¤.";
      } catch (e) {
        console.error(e);
        msg.textContent = "ë¹„ë°€ë²ˆí˜¸ ë³€ê²½ ì¤‘ ì˜¤ë¥˜ê°€ ë°œìƒí–ˆìŠµë‹ˆë‹¤.";
      }
    };

    let uploadedImageBase64 = "";

    const handleImageUpload = (event) => {
      const file = event.target.files[0];
      if (!file) return;
      const reader = new FileReader();
      reader.onload = (e) => {
        const img = new Image();
        img.onload = () => {
          const canvas = document.createElement("canvas");
          const ctx = canvas.getContext("2d");
          const maxWidth = 800;
          const scale = maxWidth / img.width;
          canvas.width = maxWidth;
          canvas.height = img.height * scale;
          ctx.drawImage(img, 0, 0, canvas.width, canvas.height);
          uploadedImageBase64 = canvas.toDataURL("image/jpeg", 0.7);
        };
        img.src = e.target.result;
      };
      reader.readAsDataURL(file);
    };

    const openModal = (src) => {
      const modal = document.getElementById("imageModal");
      const img = document.getElementById("modalImage");
      img.src = src;
      modal.style.display = "flex";
    };

    const closeModal = () => {
      const modal = document.getElementById("imageModal");
      modal.style.display = "none";
      document.getElementById("modalImage").src = "";
    };

    const clearTrash = async () => {
      if (!confirm("íœ´ì§€í†µì„ ì™„ì „íˆ ë¹„ìš¸ê¹Œìš”?")) return;

      const roomRef = firestoreDoc(db, "rooms", roomId);
      await firestoreUpdate(roomRef, {
        trash: []
      });

      displayTrash();
    };

    // ğŸ”¥ í˜ì´ì§€ ë¡œë“œ ì‹œ ë°©ì˜ ë¹„ë°€ë²ˆí˜¸ ìƒíƒœ ì²´í¬
    window.addEventListener("load", initPasswordUI);
  </script>
</body>
</html>








